{"ast":null,"code":"var _jsxFileName = \"/home/com109/Desktop/ad/my-app/src/timeline/timeline.js\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport socketIOClient from \"socket.io-client\";\nimport { updateLoginState, updateCategories, resetLoginState } from \"../redux/actions\";\nimport fetchData from \"../shared/sharedFunctions\";\nimport { Routes, ServerUrl } from \"../shared/config\";\nimport TimelineBodyComponent from \"./timelineBodyComponent\";\nconst {\n  Likes,\n  Category,\n  Upload,\n  AllPosts,\n  UserData,\n  TotalNumberOfPosts\n} = Routes;\nconst zero = 0;\nlet hasMoreItems = true;\nlet totalPosts = \"\";\nlet clicked = false;\nlet username = \"\";\nlet emailId = \"\";\nlet myUploads = false;\nlet postdata = [];\n\nconst categoryUploadForm = function () {\n  if (!clicked) {\n    clicked = true;\n    const form = \"category<input type='text' name='category' required/><br /><br /><input type='submit'/> &emsp;\";\n    document.getElementById(\"category\").innerHTML = form;\n  } else {\n    document.getElementById(\"category\").innerHTML = \"\";\n    clicked = false;\n  }\n};\n\nconst userDetails = function () {\n  let UserID = {\n    id: localStorage.getItem(\"userId\")\n  };\n  fetchData(UserData, UserID).then(res => {\n    var _res$data$zero, _res$data$zero2;\n\n    if (res && res.data) username = (_res$data$zero = res.data[zero]) === null || _res$data$zero === void 0 ? void 0 : _res$data$zero.username;\n    emailId = (_res$data$zero2 = res.data[zero]) === null || _res$data$zero2 === void 0 ? void 0 : _res$data$zero2.email;\n  });\n};\n\nconst DownloadImage = function (image) {\n  fetch(ServerUrl + \"/\" + image).then(response => {\n    response.blob().then(blob => {\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = image;\n      a.click();\n    });\n  });\n};\n\nconst totalNumberPosts = function () {\n  const data = {\n    email: myUploads ? emailId : null\n  };\n  fetchData(TotalNumberOfPosts, data).then(res => {\n    if (res) {\n      var _res$data;\n\n      totalPosts = (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.counts;\n    }\n  });\n};\n\nconst likePost = function (postID) {\n  let likedData = {\n    postId: postID,\n    userId: localStorage.getItem(\"userId\")\n  };\n  fetchData(Likes, likedData).then(res => {\n    if (res === null || res === void 0 ? void 0 : res.data) {\n      var _res$data2;\n\n      let likeData = res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.dataFromDatabase[0];\n\n      for (let i = zero; i < postdata.length; i++) {\n        if (postdata[i]._id === likeData._id) {\n          let newpostData = postdata;\n          newpostData[i].likes = likeData.likes;\n          postdata = newpostData;\n        }\n      }\n    }\n  });\n};\n\nclass Timeline extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.stateUpdateOnTimelineClick = async () => {\n      this.setState({\n        items: zero\n      });\n      myUploads = false;\n      hasMoreItems = true;\n      await this.totalNumberPosts();\n      await this.allPost(this.state.items);\n    };\n\n    this.uploadCategory = event => {\n      event.preventDefault();\n      let newCategory = event.target.category.value;\n      const categoryToBeUploaded = {\n        category: newCategory\n      };\n      fetchData(Category, categoryToBeUploaded).then(res => {\n        var _res$data4;\n\n        if (res && res.data && res.data.status === \"Category Inserted\") {\n          var _res$data3, _res$data3$dataFromDa;\n\n          let allCategory = res === null || res === void 0 ? void 0 : (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : (_res$data3$dataFromDa = _res$data3.dataFromDatabase) === null || _res$data3$dataFromDa === void 0 ? void 0 : _res$data3$dataFromDa.map(data => {\n            return data;\n          });\n          this.props.updateCategory(allCategory);\n        }\n\n        if (res && ((_res$data4 = res.data) === null || _res$data4 === void 0 ? void 0 : _res$data4.status) === \"Already Exist\") {\n          alert(\"This category already exist\");\n        }\n      }).catch(err => {\n        if (err.message === \"Network Error\") {\n          this.props.history.push(\"/errorpage\");\n        }\n      });\n      clicked = false;\n      document.getElementById(\"category\").innerHTML = \"\";\n    };\n\n    this.togglePopup = () => {\n      this.setState({\n        showPopup: !this.state.showPopup\n      });\n    };\n\n    this.loadMorePosts = () => {\n      if (this.state.items <= totalPosts) {\n        setTimeout(async () => {\n          await this.allPost(this.state.items);\n        }, 1000);\n      } else {\n        hasMoreItems = false;\n      }\n\n      return new Promise(resolve => {\n        resolve(true);\n      });\n    };\n\n    this.allPost = skipPosts => {\n      const post = {\n        Skip: skipPosts,\n        email: myUploads ? emailId : false\n      };\n      fetchData(AllPosts, post).then(res => {\n        if (res) {\n          var _res$data5;\n\n          let allPostsData = (_res$data5 = res.data) === null || _res$data5 === void 0 ? void 0 : _res$data5.dataFromDatabase;\n\n          if (skipPosts === zero) {\n            postdata = allPostsData;\n            this.setState({\n              items: skipPosts + 5\n            });\n          } else {\n            postdata = [...postdata, ...allPostsData];\n            this.setState({\n              items: skipPosts + 5\n            });\n          }\n        }\n      }).catch(err => {\n        this.setState({\n          hasError: true\n        });\n      });\n    };\n\n    this.showMyUploads = async () => {\n      this.setState({\n        items: zero\n      });\n      myUploads = true;\n      hasMoreItems = true;\n      await this.totalNumberPosts();\n      await this.allPost(this.state.items);\n    };\n\n    this.checkIfNotlogin = () => {\n      if (!localStorage.getItem(\"userId\")) {\n        this.props.history.push(\"/login\");\n      }\n    };\n\n    this.setupSocket = () => {\n      const {\n        endpoint\n      } = this.state;\n      const socket = socketIOClient(endpoint);\n      socket.on(\"FromAPI\", data => this.setState({\n        response: data\n      }));\n    };\n\n    this.state = {\n      showPopup: false,\n      // postdata: [],\n      items: zero,\n      response: false,\n      endpoint: ServerUrl\n    };\n    this.handlePostUploadForm = this.handlePostUploadForm.bind(this);\n    this.userDetails = userDetails.bind(this);\n    this.DownloadImage = DownloadImage.bind(this);\n    this.categoryUploadForm = categoryUploadForm.bind(this);\n    this.totalNumberPosts = totalNumberPosts.bind(this);\n    this.likePost = likePost.bind(this);\n  }\n\n  static getDerivedStateFromError(error) {\n    return {\n      hasError: true\n    };\n  }\n\n  componentDidMount() {\n    this.checkIfNotlogin();\n    this.props.updateLoginState(localStorage.getItem(\"userId\"));\n    this.setupSocket();\n    this.totalNumberPosts();\n    this.userDetails();\n  }\n\n  handlePostUploadForm(event) {\n    var _event$target, _event$target$categor;\n\n    event.preventDefault();\n\n    if ((event === null || event === void 0 ? void 0 : (_event$target = event.target) === null || _event$target === void 0 ? void 0 : (_event$target$categor = _event$target.category) === null || _event$target$categor === void 0 ? void 0 : _event$target$categor.value) === \"none\") {\n      document.getElementById(\"category123\").focus();\n    } else {\n      let category = event.target.category.value;\n      let file = event.target.file.files[0];\n      let caption = event.target.description.value;\n      let userName = username;\n      let userEmail = emailId;\n      const formdata = new FormData();\n      formdata.append(\"username\", userName);\n      formdata.append(\"email\", userEmail);\n      formdata.append(\"caption\", caption);\n      formdata.append(\"category\", category);\n      formdata.append(\"file\", file);\n      fetchData(Upload, formdata).then(res => {\n        var _res$data6;\n\n        if (res && ((_res$data6 = res.data) === null || _res$data6 === void 0 ? void 0 : _res$data6.status) === \"Post Inserted\") {\n          this.allPost(zero);\n        } else {\n          alert(\"not inserted\");\n        }\n\n        this.togglePopup();\n      }).catch(err => {\n        this.setState({\n          hasError: true\n        });\n      });\n    }\n  }\n\n  render() {\n    const {\n      hasError,\n      showPopup,\n      items\n    } = this.state;\n\n    if (hasError) {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        style: {\n          padding: \"200px 450px\",\n          color: \"#f47b13\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, \"404 | Something went wrong\"));\n    }\n\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, React.createElement(TimelineBodyComponent, {\n      togglePopup: this.togglePopup.bind(this),\n      categoryUploadForm: this.categoryUploadForm,\n      uploadCategory: this.uploadCategory,\n      username: username,\n      showMyUploads: this.showMyUploads,\n      stateUpdateOnTimelineClick: this.stateUpdateOnTimelineClick,\n      handlePostUploadForm: this.handlePostUploadForm,\n      items: items,\n      loadMorePosts: this.loadMorePosts,\n      hasMoreItems: hasMoreItems,\n      postdata: postdata,\n      likePost: this.likePost,\n      showPopup: showPopup,\n      hasError: hasError,\n      downLoad: this.DownloadImage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268\n      },\n      __self: this\n    }));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    category: state.CategoryReducer.category\n  };\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    updateLoginState: data => dispatch(updateLoginState(data)),\n    updateCategory: data => dispatch(updateCategories(data)),\n    resetLoginState: () => dispatch(resetLoginState())\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Timeline);","map":{"version":3,"sources":["/home/com109/Desktop/ad/my-app/src/timeline/timeline.js"],"names":["React","connect","socketIOClient","updateLoginState","updateCategories","resetLoginState","fetchData","Routes","ServerUrl","TimelineBodyComponent","Likes","Category","Upload","AllPosts","UserData","TotalNumberOfPosts","zero","hasMoreItems","totalPosts","clicked","username","emailId","myUploads","postdata","categoryUploadForm","form","document","getElementById","innerHTML","userDetails","UserID","id","localStorage","getItem","then","res","data","email","DownloadImage","image","fetch","response","blob","url","window","URL","createObjectURL","a","createElement","href","download","click","totalNumberPosts","counts","likePost","postID","likedData","postId","userId","likeData","dataFromDatabase","i","length","_id","newpostData","likes","Timeline","Component","constructor","props","stateUpdateOnTimelineClick","setState","items","allPost","state","uploadCategory","event","preventDefault","newCategory","target","category","value","categoryToBeUploaded","status","allCategory","map","updateCategory","alert","catch","err","message","history","push","togglePopup","showPopup","loadMorePosts","setTimeout","Promise","resolve","skipPosts","post","Skip","allPostsData","hasError","showMyUploads","checkIfNotlogin","setupSocket","endpoint","socket","on","handlePostUploadForm","bind","getDerivedStateFromError","error","componentDidMount","focus","file","files","caption","description","userName","userEmail","formdata","FormData","append","render","padding","color","mapStateToProps","CategoryReducer","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\nimport socketIOClient from \"socket.io-client\";\n\nimport {\n  updateLoginState,\n  updateCategories,\n  resetLoginState\n} from \"../redux/actions\";\nimport fetchData from \"../shared/sharedFunctions\";\nimport { Routes, ServerUrl } from \"../shared/config\";\nimport TimelineBodyComponent from \"./timelineBodyComponent\";\n\nconst {\n  Likes,\n  Category,\n  Upload,\n  AllPosts,\n  UserData,\n  TotalNumberOfPosts\n} = Routes;\n\nconst zero = 0;\nlet hasMoreItems = true;\nlet totalPosts = \"\";\nlet clicked = false;\nlet username = \"\";\nlet emailId = \"\";\nlet myUploads = false;\nlet postdata = [];\n\nconst categoryUploadForm = function() {\n  if (!clicked) {\n    clicked = true;\n    const form =\n      \"category<input type='text' name='category' required/><br /><br /><input type='submit'/> &emsp;\";\n    document.getElementById(\"category\").innerHTML = form;\n  } else {\n    document.getElementById(\"category\").innerHTML = \"\";\n    clicked = false;\n  }\n};\n\nconst userDetails = function() {\n  let UserID = { id: localStorage.getItem(\"userId\") };\n  fetchData(UserData, UserID).then(res => {\n    if (res && res.data) username = res.data[zero]?.username;\n    emailId = res.data[zero]?.email;\n  });\n};\nconst DownloadImage = function(image) {\n  fetch(ServerUrl + \"/\" + image).then(response => {\n    response.blob().then(blob => {\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = image;\n      a.click();\n    });\n  });\n};\n\nconst totalNumberPosts = function() {\n  const data = { email: myUploads ? emailId : null };\n  fetchData(TotalNumberOfPosts, data).then(res => {\n    if (res) {\n      totalPosts = res.data?.counts;\n    }\n  });\n};\n\nconst likePost = function(postID) {\n  let likedData = {\n    postId: postID,\n    userId: localStorage.getItem(\"userId\")\n  };\n  fetchData(Likes, likedData).then(res => {\n    if (res?.data) {\n      let likeData = res?.data?.dataFromDatabase[0];\n      for (let i = zero; i < postdata.length; i++) {\n        if (postdata[i]._id === likeData._id) {\n          let newpostData = postdata;\n          newpostData[i].likes = likeData.likes;\n          postdata = newpostData;\n        }\n      }\n    }\n  });\n};\n\nclass Timeline extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showPopup: false,\n      // postdata: [],\n      items: zero,\n      response: false,\n      endpoint: ServerUrl\n    };\n    this.handlePostUploadForm = this.handlePostUploadForm.bind(this);\n    this.userDetails = userDetails.bind(this);\n    this.DownloadImage = DownloadImage.bind(this);\n    this.categoryUploadForm = categoryUploadForm.bind(this);\n    this.totalNumberPosts = totalNumberPosts.bind(this);\n    this.likePost = likePost.bind(this);\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true };\n  }\n\n  componentDidMount() {\n    this.checkIfNotlogin();\n    this.props.updateLoginState(localStorage.getItem(\"userId\"));\n    this.setupSocket();\n    this.totalNumberPosts();\n    this.userDetails();\n  }\n\n  stateUpdateOnTimelineClick = async () => {\n    this.setState({\n      items: zero\n    });\n    myUploads = false;\n    hasMoreItems = true;\n    await this.totalNumberPosts();\n    await this.allPost(this.state.items);\n  };\n\n  uploadCategory = event => {\n    event.preventDefault();\n    let newCategory = event.target.category.value;\n    const categoryToBeUploaded = { category: newCategory };\n    fetchData(Category, categoryToBeUploaded)\n      .then(res => {\n        if (res && res.data && res.data.status === \"Category Inserted\") {\n          let allCategory = res?.data?.dataFromDatabase?.map(data => {\n            return data;\n          });\n          this.props.updateCategory(allCategory);\n        }\n        if (res && res.data?.status === \"Already Exist\") {\n          alert(\"This category already exist\");\n        }\n      })\n      .catch(err => {\n        if (err.message === \"Network Error\") {\n          this.props.history.push(\"/errorpage\");\n        }\n      });\n    clicked = false;\n    document.getElementById(\"category\").innerHTML = \"\";\n  };\n\n  handlePostUploadForm(event) {\n    event.preventDefault();\n    if (event?.target?.category?.value === \"none\") {\n      document.getElementById(\"category123\").focus();\n    } else {\n      let category = event.target.category.value;\n      let file = event.target.file.files[0];\n      let caption = event.target.description.value;\n      let userName = username;\n      let userEmail = emailId;\n      const formdata = new FormData();\n      formdata.append(\"username\", userName);\n      formdata.append(\"email\", userEmail);\n      formdata.append(\"caption\", caption);\n      formdata.append(\"category\", category);\n      formdata.append(\"file\", file);\n      fetchData(Upload, formdata)\n        .then(res => {\n          if (res && res.data?.status === \"Post Inserted\") {\n            this.allPost(zero);\n          } else {\n            alert(\"not inserted\");\n          }\n          this.togglePopup();\n        })\n        .catch(err => {\n          this.setState({ hasError: true });\n        });\n    }\n  }\n\n  togglePopup = () => {\n    this.setState({\n      showPopup: !this.state.showPopup\n    });\n  };\n\n  loadMorePosts = () => {\n    if (this.state.items <= totalPosts) {\n      setTimeout(async () => {\n        await this.allPost(this.state.items);\n      }, 1000);\n    } else {\n      hasMoreItems = false;\n    }\n    return new Promise(resolve => {\n      resolve(true);\n    });\n  };\n\n  allPost = skipPosts => {\n    const post = {\n      Skip: skipPosts,\n      email: myUploads ? emailId : false\n    };\n    fetchData(AllPosts, post)\n      .then(res => {\n        if (res) {\n          let allPostsData = res.data?.dataFromDatabase;\n          if (skipPosts === zero) {\n            postdata = allPostsData;\n            this.setState({\n              items: skipPosts + 5\n            });\n          } else {\n            postdata = [...postdata, ...allPostsData];\n            this.setState({\n              items: skipPosts + 5\n            });\n          }\n        }\n      })\n      .catch(err => {\n        this.setState({ hasError: true });\n      });\n  };\n\n  showMyUploads = async () => {\n    this.setState({\n      items: zero\n    });\n    myUploads = true;\n    hasMoreItems = true;\n    await this.totalNumberPosts();\n    await this.allPost(this.state.items);\n  };\n\n  checkIfNotlogin = () => {\n    if (!localStorage.getItem(\"userId\")) {\n      this.props.history.push(\"/login\");\n    }\n  };\n\n  setupSocket = () => {\n    const { endpoint } = this.state;\n    const socket = socketIOClient(endpoint);\n    socket.on(\"FromAPI\", data => this.setState({ response: data }));\n  };\n\n  render() {\n    const { hasError, showPopup, items } = this.state;\n    if (hasError) {\n      return (\n        <div>\n          <h1 style={{ padding: \"200px 450px\", color: \"#f47b13\" }}>\n            404 | Something went wrong\n          </h1>\n        </div>\n      );\n    }\n    return (\n      <div>\n        <TimelineBodyComponent\n          togglePopup={this.togglePopup.bind(this)}\n          categoryUploadForm={this.categoryUploadForm}\n          uploadCategory={this.uploadCategory}\n          username={username}\n          showMyUploads={this.showMyUploads}\n          stateUpdateOnTimelineClick={this.stateUpdateOnTimelineClick}\n          handlePostUploadForm={this.handlePostUploadForm}\n          items={items}\n          loadMorePosts={this.loadMorePosts}\n          hasMoreItems={hasMoreItems}\n          postdata={postdata}\n          likePost={this.likePost}\n          showPopup={showPopup}\n          hasError={hasError}\n          downLoad={this.DownloadImage}\n        />\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return { category: state.CategoryReducer.category };\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    updateLoginState: data => dispatch(updateLoginState(data)),\n    updateCategory: data => dispatch(updateCategories(data)),\n    resetLoginState: () => dispatch(resetLoginState())\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Timeline);\n"]},"metadata":{},"sourceType":"module"}