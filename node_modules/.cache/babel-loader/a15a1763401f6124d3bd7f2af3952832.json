{"ast":null,"code":"var _jsxFileName = \"/home/com109/Desktop/ad/my-app/src/timeline/timeline.js\";\nimport React from \"react\";\nimport { connect } from \"react-redux\"; // import socketIOClient from \"socket.io-client\";\n\nimport { updateLoginState, updateCategories, resetLoginState } from \"../redux/actions\";\nimport fetchData from \"../shared/sharedFunctions\";\nimport { ErrorMessage } from \"../shared/sharedFunctions\";\nimport { Routes, ServerUrl } from \"../config\";\nimport TimelineBodyComponent from \"./timelineBodyComponent\";\nimport { relativeTimeThreshold } from \"moment\";\nconst {\n  Likes_Post,\n  // Category,\n  Upload,\n  AllPosts,\n  UserData,\n  TotalNumberOfPosts\n} = Routes;\nconst zero = 0; // let clicked = false;\n\nlet username = \"\";\nlet emailId = \"\";\nlet myUploads = false; // let endpoint = ServerUrl;\n\nlet hasError = false; // const categoryUploadForm = function() {\n//   if (!clicked) {\n//     clicked = true;\n//     const form =\n//       \"category<input type='text' name='category' required/><br /><br /><input type='submit'/> &emsp;\";\n//     document.getElementById(\"category\").innerHTML = form;\n//   } else {\n//     document.getElementById(\"category\").innerHTML = \"\";\n//     clicked = false;\n//   }\n// };\n\nconst userDetails = function () {\n  let UserID = {\n    id: localStorage.getItem(\"userId\")\n  };\n  fetchData(UserData, UserID).then(res => {\n    var _res$data$zero, _res$data$zero2;\n\n    if (res && res.data) username = (_res$data$zero = res.data[zero]) === null || _res$data$zero === void 0 ? void 0 : _res$data$zero.username;\n    emailId = (_res$data$zero2 = res.data[zero]) === null || _res$data$zero2 === void 0 ? void 0 : _res$data$zero2.email;\n  });\n};\n\nconst DownloadImage = function (image) {\n  fetch(ServerUrl + \"/\" + image).then(response => {\n    response.blob().then(blob => {\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = image;\n      a.click();\n    });\n  });\n};\n\nconst totalNumberPosts = async function () {\n  const data = {\n    email: myUploads ? emailId : null\n  };\n  fetchData(TotalNumberOfPosts, data).then(res => {\n    if (res && res.data) {\n      var _res$data;\n\n      console.log(\"count\", res.data.counts);\n      this.setState({\n        totalPosts: (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.counts\n      }); // this.totalPosts = res.data?.counts;\n    }\n  });\n};\n\nconst likePost = function (postID) {\n  let likedData = {\n    postId: postID,\n    userId: localStorage.getItem(\"userId\")\n  };\n  fetchData(Likes_Post, likedData).then(res => {\n    if (res === null || res === void 0 ? void 0 : res.data) {\n      var _res$data2;\n\n      let likeData = res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.dataFromDatabase[0];\n\n      for (let i = zero; i < this.state.postdata.length; i++) {\n        if (this.state.postdata[i]._id === likeData._id) {\n          let newpostData = this.state.postdata;\n          newpostData[i].likes = likeData.likes;\n          this.setState({\n            postdata: newpostData\n          });\n        }\n      }\n    }\n  });\n}; // const setupSocket = function() {\n//   const socket = socketIOClient(endpoint);\n//   socket.on(\"FromAPI\", data => (this.response = data));\n// };\n\n\nconst checkIfNotlogin = function () {\n  if (!localStorage.getItem(\"userId\")) {\n    this.props.history.push(\"/login\");\n  }\n}; // const uploadCategory = function(event) {\n//   event.preventDefault();\n//   let newCategory = event.target.category.value;\n//   const categoryToBeUploaded = { category: newCategory };\n//   fetchData(Category, categoryToBeUploaded)\n//     .then(res => {\n//       if (res && res.data && res.data.status === \"Category Inserted\") {\n//         let allCategory = res?.data?.dataFromDatabase?.map(data => {\n//           return data;\n//         });\n//         this.props.updateCategory(allCategory);\n//       }\n//       if (res && res.data?.status === \"Already Exist\") {\n//         alert(\"This category already exist\");\n//       }\n//     })\n//     .catch(err => {\n//       if (err.message === \"Network Error\") {\n//         this.props.history.push(\"/errorpage\");\n//       }\n//     });\n//   // clicked = false;\n//   document.getElementById(\"category\").innerHTML = \"\";\n// };\n\n\nconst handlePostUploadForm = function (event) {\n  var _event$target, _event$target$categor;\n\n  event.preventDefault();\n\n  if ((event === null || event === void 0 ? void 0 : (_event$target = event.target) === null || _event$target === void 0 ? void 0 : (_event$target$categor = _event$target.category) === null || _event$target$categor === void 0 ? void 0 : _event$target$categor.value) === \"none\") {\n    document.getElementById(\"category123\").focus();\n  } else {\n    let category = event.target.category.value;\n    let file = event.target.file.files[0];\n    let caption = event.target.description.value;\n    let userName = username;\n    let userEmail = emailId;\n    const formdata = new FormData();\n    formdata.append(\"username\", userName);\n    formdata.append(\"email\", userEmail);\n    formdata.append(\"caption\", caption);\n    formdata.append(\"category\", category);\n    formdata.append(\"file\", file);\n    fetchData(Upload, formdata).then(res => {\n      var _res$data3;\n\n      if (res && ((_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : _res$data3.status) === \"Post Inserted\") {\n        this.allPost(zero);\n      } else {\n        alert(\"not inserted\");\n      }\n\n      this.togglePopup();\n    });\n  }\n};\n\nclass Timeline extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.stateUpdateOnTimelineClick = async () => {\n      this.setState({\n        items: zero,\n        hasMoreItems: true\n      });\n      myUploads = false;\n      await this.totalNumberPosts();\n      await this.allPost(this.state.items);\n    };\n\n    this.togglePopup = () => {\n      this.setState({\n        showPopup: !this.state.showPopup\n      });\n    };\n\n    this.loadMorePosts = () => {\n      if (this.state.totalPosts) {\n        if (this.state.totalPosts >= this.state.items) {\n          setTimeout(async () => {\n            await this.allPost(this.state.items);\n          }, 1000);\n        } else {\n          this.setState({\n            hasMoreItems: false\n          });\n        }\n\n        return new Promise(resolve => {\n          resolve(true);\n        });\n      } else {\n        return;\n      }\n    };\n\n    this.allPost = skipPosts => {\n      const post = {\n        Skip: skipPosts,\n        email: myUploads ? emailId : false\n      };\n      fetchData(AllPosts, post).then(res => {\n        if (res) {\n          var _res$data4;\n\n          let allPostsData = (_res$data4 = res.data) === null || _res$data4 === void 0 ? void 0 : _res$data4.dataFromDatabase;\n\n          if (skipPosts === zero) {\n            this.setState({\n              postdata: allPostsData,\n              items: skipPosts + 5\n            });\n          } else {\n            this.setState({\n              items: skipPosts + 5,\n              postdata: [...this.state.postdata, ...allPostsData]\n            });\n          }\n        }\n      });\n    };\n\n    this.showMyUploads = async () => {\n      this.setState({\n        items: zero,\n        hasMoreItems: true\n      });\n      myUploads = true;\n      await this.totalNumberPosts();\n      await this.allPost(this.state.items);\n    };\n\n    this.response = false;\n    this.state = {\n      hasMoreItems: true,\n      postdata: [],\n      showPopup: false,\n      items: zero,\n      totalPosts: 0\n    };\n    this.userDetails = userDetails.bind(this);\n    this.DownloadImage = DownloadImage.bind(this); // this.categoryUploadForm = categoryUploadForm.bind(this);\n\n    this.totalNumberPosts = totalNumberPosts.bind(this);\n    this.likePost = likePost.bind(this); // this.setupSocket = setupSocket.bind(this);\n\n    this.checkIfNotlogin = checkIfNotlogin.bind(this); // this.uploadCategory = uploadCategory.bind(this);\n\n    this.handlePostUploadForm = handlePostUploadForm.bind(this);\n    this.totalNumberPosts();\n  }\n\n  static getDerivedStateFromError(error) {\n    return hasError = true;\n  }\n\n  componentDidMount() {\n    this.checkIfNotlogin();\n    this.props.updateLoginState(localStorage.getItem(\"userId\")); // this.setupSocket();\n\n    this.userDetails();\n  }\n\n  render() {\n    const {\n      showPopup,\n      items,\n      postdata,\n      hasMoreItems\n    } = this.state;\n\n    if (hasError) {\n      ErrorMessage();\n    } else {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, React.createElement(TimelineBodyComponent, {\n        togglePopup: this.togglePopup.bind(this) // categoryUploadForm={this.categoryUploadForm}\n        // uploadCategory={this.uploadCategory}\n        ,\n        username: username,\n        showMyUploads: this.showMyUploads,\n        stateUpdateOnTimelineClick: this.stateUpdateOnTimelineClick,\n        handlePostUploadForm: this.handlePostUploadForm,\n        items: items,\n        loadMorePosts: this.loadMorePosts,\n        hasMoreItems: hasMoreItems,\n        postdata: postdata,\n        likePost: this.likePost,\n        showPopup: showPopup,\n        hasError: hasError,\n        downLoad: this.DownloadImage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }));\n    }\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    category: state.CategoryReducer.category\n  };\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    updateLoginState: data => dispatch(updateLoginState(data)),\n    updateCategory: data => dispatch(updateCategories(data)),\n    resetLoginState: () => dispatch(resetLoginState())\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Timeline);","map":{"version":3,"sources":["/home/com109/Desktop/ad/my-app/src/timeline/timeline.js"],"names":["React","connect","updateLoginState","updateCategories","resetLoginState","fetchData","ErrorMessage","Routes","ServerUrl","TimelineBodyComponent","relativeTimeThreshold","Likes_Post","Upload","AllPosts","UserData","TotalNumberOfPosts","zero","username","emailId","myUploads","hasError","userDetails","UserID","id","localStorage","getItem","then","res","data","email","DownloadImage","image","fetch","response","blob","url","window","URL","createObjectURL","a","document","createElement","href","download","click","totalNumberPosts","console","log","counts","setState","totalPosts","likePost","postID","likedData","postId","userId","likeData","dataFromDatabase","i","state","postdata","length","_id","newpostData","likes","checkIfNotlogin","props","history","push","handlePostUploadForm","event","preventDefault","target","category","value","getElementById","focus","file","files","caption","description","userName","userEmail","formdata","FormData","append","status","allPost","alert","togglePopup","Timeline","Component","constructor","stateUpdateOnTimelineClick","items","hasMoreItems","showPopup","loadMorePosts","setTimeout","Promise","resolve","skipPosts","post","Skip","allPostsData","showMyUploads","bind","getDerivedStateFromError","error","componentDidMount","render","mapStateToProps","CategoryReducer","mapDispatchToProps","dispatch","updateCategory"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\n// import socketIOClient from \"socket.io-client\";\n\nimport {\n  updateLoginState,\n  updateCategories,\n  resetLoginState\n} from \"../redux/actions\";\nimport fetchData from \"../shared/sharedFunctions\";\nimport { ErrorMessage } from \"../shared/sharedFunctions\";\nimport { Routes, ServerUrl } from \"../config\";\nimport TimelineBodyComponent from \"./timelineBodyComponent\";\nimport { relativeTimeThreshold } from \"moment\";\n\nconst {\n  Likes_Post,\n  // Category,\n  Upload,\n  AllPosts,\n  UserData,\n  TotalNumberOfPosts\n} = Routes;\n\nconst zero = 0;\n// let clicked = false;\nlet username = \"\";\nlet emailId = \"\";\nlet myUploads = false;\n// let endpoint = ServerUrl;\nlet hasError = false;\n\n// const categoryUploadForm = function() {\n//   if (!clicked) {\n//     clicked = true;\n//     const form =\n//       \"category<input type='text' name='category' required/><br /><br /><input type='submit'/> &emsp;\";\n//     document.getElementById(\"category\").innerHTML = form;\n//   } else {\n//     document.getElementById(\"category\").innerHTML = \"\";\n//     clicked = false;\n//   }\n// };\n\nconst userDetails = function() {\n  let UserID = { id: localStorage.getItem(\"userId\") };\n  fetchData(UserData, UserID).then(res => {\n    if (res && res.data) username = res.data[zero]?.username;\n    emailId = res.data[zero]?.email;\n  });\n};\n\nconst DownloadImage = function(image) {\n  fetch(ServerUrl + \"/\" + image).then(response => {\n    response.blob().then(blob => {\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = image;\n      a.click();\n    });\n  });\n};\n\nconst totalNumberPosts = async function() {\n  const data = { email: myUploads ? emailId : null };\n  fetchData(TotalNumberOfPosts, data).then(res => {\n    if (res && res.data) {\n      console.log(\"count\", res.data.counts);\n      this.setState({ totalPosts: res.data?.counts });\n      // this.totalPosts = res.data?.counts;\n    }\n  });\n};\n\nconst likePost = function(postID) {\n  let likedData = {\n    postId: postID,\n    userId: localStorage.getItem(\"userId\")\n  };\n  fetchData(Likes_Post, likedData).then(res => {\n    if (res?.data) {\n      let likeData = res?.data?.dataFromDatabase[0];\n      for (let i = zero; i < this.state.postdata.length; i++) {\n        if (this.state.postdata[i]._id === likeData._id) {\n          let newpostData = this.state.postdata;\n          newpostData[i].likes = likeData.likes;\n          this.setState({ postdata: newpostData });\n        }\n      }\n    }\n  });\n};\n\n// const setupSocket = function() {\n//   const socket = socketIOClient(endpoint);\n//   socket.on(\"FromAPI\", data => (this.response = data));\n// };\n\nconst checkIfNotlogin = function() {\n  if (!localStorage.getItem(\"userId\")) {\n    this.props.history.push(\"/login\");\n  }\n};\n\n// const uploadCategory = function(event) {\n//   event.preventDefault();\n//   let newCategory = event.target.category.value;\n//   const categoryToBeUploaded = { category: newCategory };\n//   fetchData(Category, categoryToBeUploaded)\n//     .then(res => {\n//       if (res && res.data && res.data.status === \"Category Inserted\") {\n//         let allCategory = res?.data?.dataFromDatabase?.map(data => {\n//           return data;\n//         });\n//         this.props.updateCategory(allCategory);\n//       }\n//       if (res && res.data?.status === \"Already Exist\") {\n//         alert(\"This category already exist\");\n//       }\n//     })\n//     .catch(err => {\n//       if (err.message === \"Network Error\") {\n//         this.props.history.push(\"/errorpage\");\n//       }\n//     });\n//   // clicked = false;\n//   document.getElementById(\"category\").innerHTML = \"\";\n// };\n\nconst handlePostUploadForm = function(event) {\n  event.preventDefault();\n  if (event?.target?.category?.value === \"none\") {\n    document.getElementById(\"category123\").focus();\n  } else {\n    let category = event.target.category.value;\n    let file = event.target.file.files[0];\n    let caption = event.target.description.value;\n    let userName = username;\n    let userEmail = emailId;\n    const formdata = new FormData();\n    formdata.append(\"username\", userName);\n    formdata.append(\"email\", userEmail);\n    formdata.append(\"caption\", caption);\n    formdata.append(\"category\", category);\n    formdata.append(\"file\", file);\n    fetchData(Upload, formdata).then(res => {\n      if (res && res.data?.status === \"Post Inserted\") {\n        this.allPost(zero);\n      } else {\n        alert(\"not inserted\");\n      }\n      this.togglePopup();\n    });\n  }\n};\n\nclass Timeline extends React.Component {\n  constructor(props) {\n    super(props);\n    this.response = false;\n\n    this.state = {\n      hasMoreItems: true,\n      postdata: [],\n      showPopup: false,\n      items: zero,\n      totalPosts: 0\n    };\n    this.userDetails = userDetails.bind(this);\n    this.DownloadImage = DownloadImage.bind(this);\n    // this.categoryUploadForm = categoryUploadForm.bind(this);\n    this.totalNumberPosts = totalNumberPosts.bind(this);\n    this.likePost = likePost.bind(this);\n    // this.setupSocket = setupSocket.bind(this);\n    this.checkIfNotlogin = checkIfNotlogin.bind(this);\n    // this.uploadCategory = uploadCategory.bind(this);\n    this.handlePostUploadForm = handlePostUploadForm.bind(this);\n    this.totalNumberPosts();\n  }\n\n  static getDerivedStateFromError(error) {\n    return (hasError = true);\n  }\n\n  componentDidMount() {\n    this.checkIfNotlogin();\n    this.props.updateLoginState(localStorage.getItem(\"userId\"));\n    // this.setupSocket();\n    this.userDetails();\n  }\n  stateUpdateOnTimelineClick = async () => {\n    this.setState({ items: zero, hasMoreItems: true });\n    myUploads = false;\n    await this.totalNumberPosts();\n    await this.allPost(this.state.items);\n  };\n\n  togglePopup = () => {\n    this.setState({ showPopup: !this.state.showPopup });\n  };\n\n  loadMorePosts = () => {\n    if (this.state.totalPosts) {\n      if (this.state.totalPosts >= this.state.items) {\n        setTimeout(async () => {\n          await this.allPost(this.state.items);\n        }, 1000);\n      } else {\n        this.setState({ hasMoreItems: false });\n      }\n      return new Promise(resolve => {\n        resolve(true);\n      });\n    } else {\n      return;\n    }\n  };\n\n  allPost = skipPosts => {\n    const post = {\n      Skip: skipPosts,\n      email: myUploads ? emailId : false\n    };\n    fetchData(AllPosts, post).then(res => {\n      if (res) {\n        let allPostsData = res.data?.dataFromDatabase;\n        if (skipPosts === zero) {\n          this.setState({ postdata: allPostsData, items: skipPosts + 5 });\n        } else {\n          this.setState({\n            items: skipPosts + 5,\n            postdata: [...this.state.postdata, ...allPostsData]\n          });\n        }\n      }\n    });\n  };\n\n  showMyUploads = async () => {\n    this.setState({ items: zero, hasMoreItems: true });\n    myUploads = true;\n    await this.totalNumberPosts();\n    await this.allPost(this.state.items);\n  };\n\n  render() {\n    const { showPopup, items, postdata, hasMoreItems } = this.state;\n    if (hasError) {\n      ErrorMessage();\n    } else {\n      return (\n        <div>\n          <TimelineBodyComponent\n            togglePopup={this.togglePopup.bind(this)}\n            // categoryUploadForm={this.categoryUploadForm}\n            // uploadCategory={this.uploadCategory}\n            username={username}\n            showMyUploads={this.showMyUploads}\n            stateUpdateOnTimelineClick={this.stateUpdateOnTimelineClick}\n            handlePostUploadForm={this.handlePostUploadForm}\n            items={items}\n            loadMorePosts={this.loadMorePosts}\n            hasMoreItems={hasMoreItems}\n            postdata={postdata}\n            likePost={this.likePost}\n            showPopup={showPopup}\n            hasError={hasError}\n            downLoad={this.DownloadImage}\n          />\n        </div>\n      );\n    }\n  }\n}\n\nfunction mapStateToProps(state) {\n  return { category: state.CategoryReducer.category };\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    updateLoginState: data => dispatch(updateLoginState(data)),\n    updateCategory: data => dispatch(updateCategories(data)),\n    resetLoginState: () => dispatch(resetLoginState())\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Timeline);\n"]},"metadata":{},"sourceType":"module"}